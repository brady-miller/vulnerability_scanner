#!/usr/bin/env python3

import scanner
import argparse

def get_options():
    parser = argparse.ArgumentParser()
    parser.add_argument("-t", "--target", dest="target_url", help="Target url to scan")
    parser.add_argument("-ig", "--ignore", dest="ignore_links", help="OPTIONAL - Link to ignore")
    parser.add_argument("-u", "--username", dest="username", help="OPTIONAL - Username to authenticate with")
    parser.add_argument("-p", "-password", dest="password", help="OPTIONAL - Password to authenticate with")
    parser.add_argument("-lp", "--login-page", dest="login_page", help="OPTIONAL - Login page to authenticate from")
    parser.add_argument("-ls", "--login-submit", dest="login_submit", help="OPTIONAL - Element type to submit for authentication")
    arguments = parser.parse_args()
    if not arguments.target_url:
        parser.error("[-] Please specify a target url")
    return arguments

arguments = get_options()

session_data = {
    "username": arguments.username,
    "password": arguments.password,
    "Login": arguments.login_submit
}

target_url = arguments.target_url
links_to_ignore = arguments.ignore_links

vuln_scanner = scanner.Scanner(target_url, links_to_ignore)
if arguments.login_page:
    vuln_scanner.session.post("http://10.0.2.20/dvwa/login.php", data=session_data)

vuln_scanner.crawl()
vuln_scanner.run_scanner()